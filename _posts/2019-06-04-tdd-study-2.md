---
layout: post
title: "TDD 스터디 TMI 회고 - 2. 테스트 주도 개발 - 켄트백"
author: soomin
date: 2019-06-03 00:00
tags: [ruby,tdd]
image: /files/covers/tdd.png
---



## 테스트 주도 개발(TDD) - 켄트백 회고

책을 읽고 깨달은 여러가지 TMI 

#### 뭐라고 하는지 잘 모르겠읍니다..재미없엄...

모든 책이 재미 없죠~! 하지만 이 책을 읽은 자.. 아래 내용 공감될걸요..?

- 번역체...

- 저자가 개그치는데 하나도 안 웃김 (==노잼)

- 엄~~~청느리다

사실 막 저자가 웃길려고 개그치는거인지, 쉽게 설명 하려고 설명 TMI 가 길어서인지 너무 글이 길어지는게 힘들었다. 이건 내가 이해력 & 인내력이 부족해서 일 수도. 

근데 스터디가 재정비 되면서 chap01 ~ chap07 를 한 두~세번씩 반복해서 읽다보니 __아! 이 저자가 무슨말을 하는지 그 때 알았다.__ 회독의 중요성을 깨달았다. (고등학교때 이렇게 공부할 껄..)

#### WELCOME TO RUBY

나는 `ROR` 로 개발을 하고있지만, 나는 `Rails` 를 알았지, `Ruby` 를 잘 알지 못했구나! 를 깨달았다. 사실 실제 생활도 마찬가지. 내가 한국어를 다~아는게 아니라 부분만 쓰는거지 내가 무슨 건축 공무 설계 또는 해부의학 관련 용어 하나도 몰라도 쓰는것만 쓰면 잘 쓸수 있으니. 레일즈 삽질만 하다 루비 삽질을 하다 보니 좀 신기하고 하 내가 개발자일까.. 라는 회의감도 들었다~! 그래도 알면 됏찌~! 알게 된 것 중 가장 소개하고 싶은 항목을 소개한다. 

#### ruby 의 연산자 메서드

책 속에서  `.equals()`  재 정의 후 `assert_equal()` 메서드를 사용하여 테스트 하는 코드가 있는데. 루비에서 값이 아닌 메모리 주소를 비교하여 계속 에러가 발생했다. 열받아서 샘플 코드를 찾아보다가 발견한 루비 연산자 메서드. 연산자 기호 자체를 재정의 할 수 있다. 다음에 오는 피연산자의 값을 비교한다. 

```ruby
def ==(other)
  @amount == other.amount &&
  @currency == other.currency
end
```

또 아래와 같은 __ETC__

- 런타임 언어이기 때문에, 타입 캐스팅이 필요없다. 따라서 다형성이 들어가게 리팩토링 하는 부분들은 다 건너 뛸 수 있다. 
- 인터페이스가 존재하지 않는다! 
- `attr-accesor` 한방이면 `protected / getter /setter` 다 지정된다!! 



### 반복하며 배우는 TDD

각각 챕터가 크게  1. 목표 작성 2. 테스트 작성하기 3. 실행 가능하게 만들기 4. 리팩토링 을 계속 반복하며 진행해 나간다. 그리고 완성 된 코드를 통해 새로운 __TODO__ 가 작성 되기도 한다. chap17 까지 이 반복을 진행해 가면서 어떤 느낌으로 해야되는지 감각을 익혔다



### TMI 

만약 이걸 보고 TDD 를 하게 된다면 팁!! 

##### 효율적이게 책 읽기 

- 저자 진짜 개그 재미없네.. 하면서 한번 읽는다. (코드 작성 X)
- 테스트 코드를 작성해보자. (조금만 틀려도 에러나니 계속 실행 돌려본다.)
- 챕터를 요약해본다. <http://soomtopia.github.io/2019/05/12/tdd-chap01/>



##### github 에 남기기

이건 테스트 코드 샘플 찾아보다가 좋은 방법이여서 나도 해보는 중! 다시 회독하면서 읽어보니 더 잘 이해가 된다.

- 샘플마다 이 테스트 코드에 대한 내용을 요약 후 커밋 한다. 
- 내가 본 샘플은 `master` 하나에 적용 해놨지만 나는 `branch` 하나씩 파서 진행중. 
- 하루에 하나씩 헤비하지 않고 괜찮다. 머리 식힐 때 좋음 
- <https://github.com/soomtopia/tdd-ruby>

##### sample 참고

<https://repo.yona.io/files/4786>



## 페어프로그래밍을 통한 자판기 구성하기

다른 페어는, 어떤식으로 하는지 모르겠지만, 우리는 한 사람이 키를 잡고 순서를 정한 후, 코멘트를 받아 진행해 가기로했다. 사실 테스트 완성 후 그 다음 보이는 __TODO__ 를 가지고 진행해야 옳지만, 2주 안에 완성을 해야되는데 매일 만나서 할 수 없는 처지기 때문에 이런식으로 첫 발을 내딛었다. 같은 시나리오더라도, 방향을 다르게 잡으면 과정은 완전 다르니, 즐거운 길이었다. 



## 책에서 제공해준 요구사항 / 시나리오

책에서 제공해준 요구사항 / 시나리오는 아래와 같다.

##### 최소 요구사항

```
- 최소 개수의 동전으로 잔돈을 돌려준다.
예) 1000원 넣고 650원짜리 음료를 선택했다면,
잔돈은 100, 100, 100, 50원으로 반환한다.
- 지폐를 잔돈으로 반환하는 경우는 없다고
가정한다.
```

##### 업무 시나리오

```
돈을 넣는다.
→ 투입한 금액이 표시된다.
→ 투입한 금액 내에서 선택 가능한 음료가 있다면 해당 버튼에 불이 들어온다.
→ 음료를 선택한다.
→ 음료가 나온다.
→ 투입금액 표시화면에는 선택한 음료 가격만큼 제외된 가격이 표시된다.
→ 만일 표시된 남은 금액이 다른 음료를 선택할 수 있는 금액 이하이면 바로 잔돈으로
반환한다.
→ 다른 음료를 선택할 수 있는 금액이 남아 있다면 최초 동전을 넣었을 때와 동일하게
동작한다.
→ 반환 버튼을 눌렀을 경우 상황에 관계없이 표시되어 있는 금액을 최소 잔돈으로 반환
한다.
```



## 내가 짠 tdd 방향

나는 큰 방법을 처음 정하고, 단계별로 세부한 내역을 잡아가는 뱡향으로 생각을 했다. 

##### TEST1 - **음료수 뽑기 케이스 단계**

```
 1. 이용자가 돈을 넣는다.
 2. 음료수를 선택할 수 있다.
 3. 음료수를 선택한다.
 4. 음료수가 나온다.
 5. 잔돈을 반환한다.
```

##### TEST2 - 돈을 넣는다 세부 케이스 - 돈 입력/출력 유효성 검사

```
- 선언한 돈 객체의 단위가 맞는지 틀린지 체크
1. 돈의 단위는 50, 100, 500, 1000, 5000 으로 들어온다.
2. 반환 단위도 50, 100, 500, 1000, 5000 으로 반환해야한다.
3. 투입한 금액을 표시한다.
(반환 금액이 있는지 없는지 체크한다.)
# 2,3 > 입력 이후 잘못 입력되면 경고 메세지를 띄운다. 다시 입력받기. 
```

##### TEST3 음료수를 선택한다. 세부 케이스 - 음료수 케이스 유효성 검사

```
1. 투입된 금액이 음료의 가격보다 낮으면 선택할 수 없다.
2. 투입된 금액이 음료의 가격보다 높으면 선택할 수 있다.
```

##### TEST4. 음료수를 선택한다. 세부케이스 - 음료수 수량 케이스 검사

```
1. 남은 음료수가 있으면 - able
2. 남은 음료수가 없으면 - disable - 품절
```

##### TEST5. 음료가 나온다. 세부케이스 - 선택 이후 잔액 표시

```
1. 음료 값에서 차감된 잔돈으로 표시를 변경해준다.
```

##### TEST6. 잔돈을 반환한다. 세부케이스 - 금액 확인 세부 조건

```
1. 음료를 내보낸 후, 잔액이 남아있는지 확인한다.
2. 잔액으로 살 수 있는 음료수가 있는지 확인한다.
3. 확인 후, 살 수 있는 음료수가 있다면 잔돈을 반환하지 않고 선택을 기다린다.
4. 확인 후, 살 수 있는 음료수가 없다면 잔돈을 반환하고 종료한다. 
```

##### TEST7. 잔돈을 반환한다. 세부 케이스 - 반환 버튼 체크

```
1. 반환 버튼을 누른 경우, 잔액을 반환한다. 
```

이런식으로 노션에 작성하고 페어 프로그래밍을 하기 위해 만났다.



## 1+1=100을 주는 페어 프로그래밍 

사실 페어프로그래밍이 좋다 들었는데, 경험 해본적이 없었다. 하지만 이때 왜 좋은지 엄청 알게 되었다.

같이 작업하는 재욱님께서 자신의 조언을 받은 tdd 가이드가 결합되어, 이 tdd 자체가 `테스트케이스` 만 테스트 해보는게 아닌

`객체 지향적 설계` 를 포함해서 생각하고, `클린 코드` 에 대해 더욱 생각하고 작성하는 계기가 되었다. 



## TMI

- 블로그 정리 + 스터디 숙제를 통해 1독 후, 샘플 커밋을 위해 2독을 하는 중! 두번 읽을 때 훨씬 이해가 쉽다. 3독이 목표이다.